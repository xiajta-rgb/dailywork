name: 每日自动爬取GitHub趋势数据
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  crawl-trend:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # 超时从30分钟缩短到5分钟（足够完成核心操作）
    steps:
      - name: 拉取仓库最新代码
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 配置Python 3.11环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: ''

      - name: 安装依赖（极简安装）
        run: |
          python -m pip install --upgrade pip
          pip install playwright>=1.40.0  # 直接安装，不判断requirements.txt，节省时间

      - name: 安装浏览器（精简）
        run: playwright install chromium --with-deps  # 一步安装浏览器+依赖，节省步骤时间

      - name: 执行核心操作（点击按钮即退出）
        env:
          ADMIN_USERNAME: ${{ secrets.ADMIN_USERNAME }}
          ADMIN_PASSWORD: ${{ secrets.ADMIN_PASSWORD }}
          BASE_URL: "https://trend.pythonanywhere.com"
        run: |
          # 无日志文件、无多余检查，直接执行脚本
          python daily_update.py
